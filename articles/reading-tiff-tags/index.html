<!doctype html> <html lang=en> <head> <meta charset=utf-8> <meta content="width=device-width,initial-scale=1" name=viewport> <meta content=#333333 name=theme-color> <base href=/ > <link href=manifest.json rel=manifest crossorigin=use-credentials> <link href=favicon.png rel=icon type=image/png> <link href=index.css rel=stylesheet> <noscript id=sapper-head-start></noscript><title>Reading Tiff Tags üè∑ // Matt Brealey</title><meta content="For my new tool, Geode, I needed to learn ALL about tiff tags. Turns out, there's a LOT of them..." name=description><meta content="geode, tiff, code, geotiff, mapping, data, gis" name=keywords><meta content=website property=og:type><meta content=https://mattbrealey.com/articles/reading-tiff-tags property=og:url><meta content="Reading Tiff Tags üè∑" property=og:title><meta content="For my new tool, Geode, I needed to learn ALL about tiff tags. Turns out, there's a LOT of them..." property=og:description><meta content=https://mattbrealey.com/images/articles/reading-tiff-tags/tags.png property=og:image><meta content=summary_large_image property=twitter:card><meta content=https://mattbrealey.com/articles/reading-tiff-tags property=twitter:url><meta content="Reading Tiff Tags üè∑" property=twitter:title><meta content="For my new tool, Geode, I needed to learn ALL about tiff tags. Turns out, there's a LOT of them..." property=twitter:description><meta content=https://mattbrealey.com/images/articles/reading-tiff-tags/tags.png property=twitter:image><noscript id=sapper-head-end></noscript> </head> <body> <div id=sapper> <div class="flex flex-col container min-h-full mx-auto"><header class="lg:p-8 sm:flex sm:items-center sm:justify-between sm:p-4"><div class="flex items-center justify-between px-4 py-4 sm:p-0"><div class=""><a href=/ alt=Home><img alt="A picture of Matt Brealey's head" src=profile.jpg class="h-12 rounded-full"></a></div> <div class=sm:hidden><button class="text-black block focus:outline-none focus:text-gray-800 hover:text-gray-800 pr-2" id=menuButton type=button><svg class="fill-current h-8 text-black w-8" viewBox="0 0 100 70"><rect height=10 width=100></rect><rect height=10 width=100 y=30></rect><rect height=10 width=100 y=60></rect></svg></button></div></div> <div class="hidden pt-2 px-2 sm:flex sm:p-0"><a href=/ class="colorLink false headerLink">Hello</a> <a href=/projects class="colorLink false headerLink" id=projectsMenuItem>Projects</a> <a href=/articles class="colorLink false headerLink">Articles</a> <div class="headerLink h-16 sm:hidden"><div class="flex items-center h-full w-full"><a href=https://twitter.com/badgrenola class="flex items-center h-full justify-center sm:w-auto w-1/3" rel="noopener noreferrer" target=_blank><svg class="fill-current h-5 hover:text-pink-500 sm:text-gray-500 text-pink-500 w-5" viewBox="40 40 300 300"><path d=M153.62,301.59c94.34,0,145.94-78.16,145.94-145.94,0-2.22,0-4.43-.15-6.63A104.36,104.36,0,0,0,325,122.47a102.38,102.38,0,0,1-29.46,8.07,51.47,51.47,0,0,0,22.55-28.37,102.79,102.79,0,0,1-32.57,12.45,51.34,51.34,0,0,0-87.41,46.78A145.62,145.62,0,0,1,92.4,107.81a51.33,51.33,0,0,0,15.88,68.47A50.91,50.91,0,0,1,85,169.86c0,.21,0,.43,0,.65a51.31,51.31,0,0,0,41.15,50.28,51.21,51.21,0,0,1-23.16.88,51.35,51.35,0,0,0,47.92,35.62,102.92,102.92,0,0,1-63.7,22A104.41,104.41,0,0,1,75,278.55a145.21,145.21,0,0,0,78.62,23></path></svg></a> <a href=https://www.linkedin.com/in/mattbrealey/ class="flex items-center h-full justify-center sm:w-auto w-1/3 sm:pl-3" rel="noopener noreferrer" target=_blank><svg class="fill-current h-5 hover:text-pink-500 sm:text-gray-500 text-pink-500 w-5" viewBox="0 0 448 512"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg></a> <a href=mailto:hello@mattbrealey.com class="flex items-center h-full justify-center sm:w-auto w-1/3 sm:pl-3"><svg class="fill-current h-5 hover:text-pink-500 sm:text-gray-500 text-pink-500 w-5" viewBox="22 60 310 240"><g><path d="m186.26 181.27l135.27-76.964c-4.07-8.469-12.72-14.31-22.73-14.31h-237.6c-10.015 0-18.664 5.841-22.728 14.303l135.27 76.964c3.44 1.96 9.08 1.96 12.52 0.01z"></path><path d="m145.46 171.43l-108.81-61.91c-0.421 1.826-0.65 3.725-0.65 5.679v125.36l109.46-69.13z"></path><path d="m324 243.93v-128.73c0-1.954-0.229-3.853-0.65-5.679l-111.62 63.506 112.27 70.9z"></path><path d="m206.81 175.83l-20.55 11.692c-3.442 1.958-9.074 1.958-12.516 0l-23.354-13.288-114.33 72.21c0.843 13.15 11.773 23.56 25.14 23.56h237.6c12.292 0 22.522-8.802 24.746-20.445l-116.74-73.73z"></path></g></svg></a></div></div></div></header> <main class="flex-grow pb-6"><div class="flex font-normal lg:p-8 p-6 sm:text-base text-base text-gray-900"><sidebar class="hidden mr-6 sm:block text-sm w-1/5"><div class="flex flex-col"><h2 class="text-pink-600 font-semibold leading-none">Latest Projects</h2> <ul class=mt-2><li class=mb-1><a href=./projects/geode>Geode (prototype)</a> <li class=mb-1><a href=./projects/areo-browser>Areo Browser</a> <li class=mb-1><a href=./projects/juno-observer>Juno Observer</a> <li class=mb-1><a href=./projects/areo>Areo</a> </ul></div> <div class="flex flex-col mt-8"><h2 class="text-pink-600 font-semibold leading-none">Latest Articles</h2> <ul class=mt-2><li class=mb-1><a href=./articles/reading-tiff-tags>Reading Tiff Tags üè∑</a> <li class=mb-1><a href=./articles/hello-motivation>Hello Motivation</a> </ul></div> <div class="-ml-1 mt-16"><div class="flex items-center h-full w-full"><a href=https://twitter.com/badgrenola class="flex items-center h-full justify-center sm:w-auto w-1/3" rel="noopener noreferrer" target=_blank><svg class="fill-current h-5 hover:text-pink-500 sm:text-gray-500 text-pink-500 w-5" viewBox="40 40 300 300"><path d=M153.62,301.59c94.34,0,145.94-78.16,145.94-145.94,0-2.22,0-4.43-.15-6.63A104.36,104.36,0,0,0,325,122.47a102.38,102.38,0,0,1-29.46,8.07,51.47,51.47,0,0,0,22.55-28.37,102.79,102.79,0,0,1-32.57,12.45,51.34,51.34,0,0,0-87.41,46.78A145.62,145.62,0,0,1,92.4,107.81a51.33,51.33,0,0,0,15.88,68.47A50.91,50.91,0,0,1,85,169.86c0,.21,0,.43,0,.65a51.31,51.31,0,0,0,41.15,50.28,51.21,51.21,0,0,1-23.16.88,51.35,51.35,0,0,0,47.92,35.62,102.92,102.92,0,0,1-63.7,22A104.41,104.41,0,0,1,75,278.55a145.21,145.21,0,0,0,78.62,23></path></svg></a> <a href=https://www.linkedin.com/in/mattbrealey/ class="flex items-center h-full justify-center sm:w-auto w-1/3 sm:pl-3" rel="noopener noreferrer" target=_blank><svg class="fill-current h-5 hover:text-pink-500 sm:text-gray-500 text-pink-500 w-5" viewBox="0 0 448 512"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg></a> <a href=mailto:hello@mattbrealey.com class="flex items-center h-full justify-center sm:w-auto w-1/3 sm:pl-3"><svg class="fill-current h-5 hover:text-pink-500 sm:text-gray-500 text-pink-500 w-5" viewBox="22 60 310 240"><g><path d="m186.26 181.27l135.27-76.964c-4.07-8.469-12.72-14.31-22.73-14.31h-237.6c-10.015 0-18.664 5.841-22.728 14.303l135.27 76.964c3.44 1.96 9.08 1.96 12.52 0.01z"></path><path d="m145.46 171.43l-108.81-61.91c-0.421 1.826-0.65 3.725-0.65 5.679v125.36l109.46-69.13z"></path><path d="m324 243.93v-128.73c0-1.954-0.229-3.853-0.65-5.679l-111.62 63.506 112.27 70.9z"></path><path d="m206.81 175.83l-20.55 11.692c-3.442 1.958-9.074 1.958-12.516 0l-23.354-13.288-114.33 72.21c0.843 13.15 11.773 23.56 25.14 23.56h237.6c12.292 0 22.522-8.802 24.746-20.445l-116.74-73.73z"></path></g></svg></a></div></div></sidebar> <div class="w-full font-light sm:w-4/5"> <div><div class="mb-4 flex flex-col sm:mb-6 w-full"><h1 class="mb-1 flex-1 font-thin sm:leading-6 sm:mb-3 text-3xl text-pink-600"><span slot=title>Reading Tiff Tags üè∑</span></h1> <div class="font-light text-gray-500 text-xs">15th April 2020 - 6 mins to read</div></div> <section slot=content> <span class=markdown><p class=mb-4>I'm currently in the process of adding several other formats to <a href=/projects/areo class=colorLink>Areo</a>, my <em>'take binary elevation data and make into exportable 3D mesh'</em> tool, one of which is <a href=https://earthdata.nasa.gov/esdis/eso/standards-and-references/geotiff class=colorLink rel="noopener noreferrer" target=_blank>Geotiff</a>. Instead of just figuring out how to read the format (boo, boring, boo), I thought I'd try and make an in-browser tool to read local tiff files, show 2D previews with custom colour mapping, and generate downloadable 3D mesh previews if applicable (hooray, 3D things, yay!) I also thought I'd briefly write it all up as I went. üëã</p> <h2 id=incredibly-useful-sources-of-information>Incredibly useful sources of information</h2> <ul> <li><a href=https://medium.com/planet-stories/reading-a-single-tiff-pixel-without-any-tiff-tools-fcbd43d8bd24 class=colorLink rel="noopener noreferrer" target=_blank>This article</a> by Patrick Armstrong really quickly got me up to speed on exactly how the header information in a .tiff file is formatted. Patrick also delves into things like compression, that I'll definitely have to address down the line.</li> <li>Want to know what that random tiff tag ID is? Want to know all the possible values in its enum? Well Joris Van Damme from <a href=https://www.awaresystems.be/imaging/tiff/tifftags.html class=colorLink rel="noopener noreferrer" target=_blank>Aware Systems</a> has you covered! This site is basically a tiff tag bible. It was <strong>insanely</strong> useful.</li> <li>As was <a href=http://geotiff.maptools.org/spec/geotiff1.html class=colorLink rel="noopener noreferrer" target=_blank>Maptools.org</a>! <em>Many</em> of my Google searches brought me back to the fantastically curated information on this site.</li> <li>Paul Bourke's <a href=http://paulbourke.net/dataformats/tiff/tiff_summary.pdf class=colorLink rel="noopener noreferrer" target=_blank>PDF Tiff Summary</a> was also <em>SUPER</em> useful in clarifying the different data types used in the format.</li> <li>Finally, I stumbled upon <a href=https://twitter.com/emilywselwood class=colorLink rel="noopener noreferrer" target=_blank>Emily Selwood</a>'s fantastic <a href=https://github.com/emilyselwood/tiffhax class=colorLink rel="noopener noreferrer" target=_blank>Tiff Hax</a> tool as I was getting into the nitty gritty of IFD reading, and although I've yet to delve into <a href=https://golang.org/ class=colorLink rel="noopener noreferrer" target=_blank>Go</a>, it was a fantastically useful sanity checker when it came to testing my own code!</li> </ul> <h2 id=breaking-down-the-format>Breaking down the format</h2> <h3 id=byte-order--a-very-magic-number>Byte Order & A Very Magic Number</h3> <p class=mb-4>At the start of <em>every</em> .tiff file there are 8 bytes of data. Something like :</p> <pre><code>4D4D002A 00000008</code></pre><p class=mb-4>The first 2 bytes are either going to be both <em>4D</em> (i.e. <em>77</em> as a UInt8), or <em>49</em> (i.e. <em>73</em> as a UInt8). If it's <em>4D (77)</em> the <a href=https://www.geeksforgeeks.org/little-and-big-endian-mystery/ class=colorLink rel="noopener noreferrer" target=_blank>byte order</a> of the file is BigEndian, if it's <em>49 (73)</em> byte order is LittleEndian. The example above is therefore BigEndian.</p> <p class=mb-4>The 3rd or 4th byte (depending on your newly found byte order) is a <a href=https://en.wikipedia.org/wiki/Magic_number_(programming) class=colorLink rel="noopener noreferrer" target=_blank>magic number</a>. Long story short, if it's not <strong>42</strong>, then this <em>isn't</em> a tiff file. Time to return/throw an error/walk away and grab lunch.</p> <p class=mb-4>The 8th byte is a byte offset telling you where the first main section of header information begins. Which leads me nicely into...</p> <h3 id=ifds-subfiles-image-bands>IFDs, subfiles, image bands...</h3> <p class=mb-4>A single tiff file <em>can</em> hold multiple different (but more often than not, at least tangentially related) images within it. These <a href=https://en.wikipedia.org/wiki/TIFF#Multiple_subfiles class=colorLink rel="noopener noreferrer" target=_blank>subfiles</a> can be incredibly useful for storing lower resolution proxies of a main image, mask data, overlay information - essentially anything you want to bundle alongside the main image data.</p> <p class=mb-4>Each one of these subfiles is described by an Image File Directory (IFD) - a section of header information containing <em>all</em> the metadata associated with that subfile. In theory. In practice, some of the tags on the first IFD are usually relevant to one or more of the subsequent IFDs, and as you delve deeper you might find other completely separate IFDs that contain <em>yet more</em> metadata relevant to the first IFD. Tiffs are nothing if not flexible.</p> <p class=mb-4>If we follow the 8 byte offset we found above, we find ourselves at the start of our first IFD, which begins with these two bytes :</p> <pre><code>0010</code></pre><p class=mb-4>This is our IFD field count, which after converting to UInt8 tells us that there are 16 fields we now need to find and parse.</p> <h3 id=fields-oh-so-many-fields>Fields. Oh so many fields...</h3> <p class=mb-4>IFD fields are always 12 bytes long, so let's grab the next 12 bytes and start parsing :</p> <pre><code>01000003 00000001 0C890000</code></pre><p class=mb-4>The first 2 bytes give us the ID of the tiff tag. Converting <code>0100</code> to a short (AKA a 16-bit unsigned int) gives us a value of 256. One search of <a href="https://www.awaresystems.be/imaging/tiff/tifftags/search.html?q=256&Submit=Find+Tags" class=colorLink rel="noopener noreferrer" target=_blank>AwareSystems Tiff Tag Reference</a> later and :</p> <p class=mb-4><img alt="ImageWidth tag details" src=images/articles/reading-tiff-tags/imageWidthTag.png></p> <p class=mb-4>We've found an <em>ImageWidth</em> tag! Let's move on and try to get the width itself.</p> <p class=mb-4>The 3rd and 4th bytes give us the data type of this tag. Converting to a short, our <code>0003</code> gives a value of 3, meaning that the image width is also going to be a short.</p> <p class=mb-4>The next 4 bytes give us the value count for the current field as a 32-bit unsigned int. In our case above, the <code>00000001</code> tells us that (logically) <em>ImageWidth</em> only has a single value. </p> <p class=mb-4>The behaviour of the remaining 4 bytes differs slightly from field to field, depending on the data the field represents. For some fields with a single (often numerical) associated value, all of that value data can be found directly within the field bytes. However, in fields representing more complex values (such as arrays of information, longer strings etc.) the remaining bytes simply act as an offset to where that information is stored in the main body of the tiff file.</p> <p class=mb-4>To determine whether the final bytes represent an offset, we can perform a simple calculation : </p> <pre><code>(# of values) * (# of bytes per value) > (# of bytes remaining)</code></pre><p class=mb-4>We know that we only have 4 bytes left from our original 12 bytes of field data, we've already calculated our value count, and we know that the data type is <em>short</em> (i.e. 2 bytes per value). So in the case of our <em>ImageWidth</em> field, this calculation becomes :</p> <pre><code>isOffset = (1 * 2) > 4</code></pre><p class=mb-4>This evaluates to false in our <em>ImageWidth</em> case, meaning that the final 4 bytes represent the actual value of the field. These bytes are <code>0C890000</code>, which we can now convert to a value of <em>3209</em>. We've found the width of our tiff file!</p> <p class=mb-4>If <em>isOffset</em> had resolved to <em>true</em>, we'd then have to perform a subsequent lookup into the tiff file, using the value of the final 4 bytes as our offset, and <code>(# of values) * (# of bytes per value)</code> as our byte count.</p> <h3 id=the-next-ifd>The next IFD...</h3> <p class=mb-4>16 fields of 12 bytes later, there are 8 more useful bytes that make up this current IFD. Converted to a long (i.e. 4 byte, 32-bit unsigned int) these bytes give you the byte offset to the next IFD contained within the tiff file. </p> <p class=mb-4>If this byte offset is > 0, you'll need to loop around and repeat all of your field parsing on this new IFD. If this is the final IFD in the file, the byte offset will be 0, and you can now relatively comfortably stop processing IFDs. Hooray!</p> <h2 id=so-far-so-good>So far, so good</h2> <p class=mb-4>So ends this first, pretty dry article about Geode! Fun, eh? üò¨ I'm hoping that the above might prove vaguely useful to anyone thinking about attempting something similar. And if not, it will at least remind me how I approached it, when I no-doubt find myself doing this again in a year or so!</p> <p class=mb-4>If you head over to <a href=https://mattbrealey.com/geode class=colorLink rel="noopener noreferrer" target=_blank>the app</a> right now, you'll be able to see the above in practice, as you can load any tiff file and browse of the available tag information for each IFD found.</p> <p class=mb-4>Next step, pixel loading!</p> </span> <hr class="w-full mt-12"> <div class="flex justify-between pt-2"><div class="flex-1 pr-6"><h3 class="text-sm text-gray-600">Previous Article</h3> <a href=./articles/hello-motivation class=colorLink>Hello Motivation</a></div> <div class="flex-1 pl-6 text-right"></div></div></section></div></div></div></main> <footer class="text-gray-500 text-xs p-4 text-center"><p>This site is currently being written using <a href=https://sapper.svelte.dev/ class=colorLink rel="noopener noreferrer" target=_blank>Sapper</a> and <a href=https://tailwindcss.com/ class=colorLink rel="noopener noreferrer" target=_blank>TailwindCSS</a> , and it's code is entirely <a href=https://github.com/badgrenola/sapper-tailwind-blog class=colorLink rel="noopener noreferrer" target=_blank>open source</a> üëç</footer></div></div> <script>__SAPPER__={baseUrl:"",preloaded:[(function(a,b,c,d){return {articles:[{title:"Reading Tiff Tags üè∑",slug:"reading-tiff-tags",smallImage:"images\u002Farticles\u002Freading-tiff-tags\u002Ftags.png",desc:"For my new tool, Geode, I needed to learn ALL about tiff tags. Turns out, there's a LOT of them...",date:"15th April 2020",timeToRead:6},{title:"Hello Motivation",slug:"hello-motivation",smallImage:"images\u002Farticles\u002Fhello-motivation\u002Fdesk.jpg",desc:"I have a terrible habit of never writing about the things I make. This site is my attempt to fix that...",date:"24th March 2020",timeToRead:b}],projects:[{id:0,slug:c,name:"Areo",smallImage:"images\u002Fareo\u002Fsplash_small.jpg",largeImage:"images\u002Fareo\u002Fsplash.jpg",shortDesc:"A Mac app designed for opening, viewing and converting Digital Terrain Models.",keywords:"areo, space, hirise, mac, osx, swift, dtm, gis, terrain, digital terrain model, mars, planet, planetary data, data",links:[{title:"Download Beta 1 v2",url:"http:\u002F\u002Fbit.ly\u002Fareo1b2"}],desc:"\u003Cp class=\"mb-4\"\u003EAreo is a custom Mac app designed for opening, viewing and converting Digital Terrain Models in the \u003Cem\u003E.IMG\u003C\u002Fem\u003E format. \u003C\u002Fp\u003E\n\u003Cp class=\"mb-4\"\u003EThe released version (available above) was designed specifically to quickly open .IMG files generated from \u003Ca class=\"colorLink\" href=\"https:\u002F\u002Fwww.uahirise.org\u002Fdtm\u002F\" target=\"_blank\" rel=\"noopener noreferrer\"\u003EHiRISE\u003C\u002Fa\u003E imagery, \nand convert them into .OBJ files at a given proxy level (\u003Cem\u003E1\u002F2, 1\u002F4, 1\u002F8\u003C\u002Fem\u003E etc.).\nIt also includes the ability to generate 3D-printable versions of these models.\u003C\u002Fp\u003E\n\u003Cp class=\"mb-4\"\u003EIt was originally created as part of a month-long project I set myself, to see if I could both understand the data structure, and \ncreate a tool that not only opens the files quickly, but also converts them into a useful, more-accessible 3D format.\u003C\u002Fp\u003E\n\u003Cp class=\"mb-4\"\u003EI have been working on a newer version of this app which expands the amount of file formats, and implements a command-line version\nof the featureset. This new version currently forms part of my \u003Ca class=\"colorLink\" href=\".\u002Fprojects\u002Fareo-browser\"\u003EAreo Browser\u003C\u002Fa\u003E data pipeline, and I plan on\ndocumenting and releasing it here in the near future.\u003C\u002Fp\u003E\n",features:[{title:"Fast. Very Fast.",desc:"Thanks to Areo's crafty use of image proxying, it takes just 4 seconds to load and process a 1.15gb DTM.",image:"https:\u002F\u002Fthumbs.gfycat.com\u002FGlumIdealisticGallinule-small.gif"},{title:"OBJ Export",desc:"Areo can quickly export a UV'd OBJ file of the current model for use in other 3D applications.",image:"https:\u002F\u002Fthumbs.gfycat.com\u002FCluelessEasygoingIceblueredtopzebra-small.gif"},{title:"Generate 3D-Printable Models",desc:"In a few clicks, Areo allows you to generate fully 3D-printable models that can be easily uploaded to your 3D-printing service of choice.",image:"https:\u002F\u002Fthumbs.gfycat.com\u002FOddQuickAfricanbushviper-small.gif"}],todos:["Clean-up the code in v2 and release"],tagName:c},{id:1,slug:"juno-observer",name:"Juno Observer",smallImage:"images\u002Fjuno-observer\u002Fsplash_small.jpeg",largeImage:"images\u002Fjuno-observer\u002Fsplash_half.jpeg",shortDesc:"A web-app allowing you to explore Junocam imagery from NASA's Juno spacecraft, projected onto a 3D Jupiter.",keywords:"juno, space, nasa, jupiter, browser, react, reactjs, mobile, desktop, planet, planetary data, data, spacecraft, orbit, perijove, mission juno",links:[{title:a,url:"https:\u002F\u002Fjuno.observer"}],desc:"\u003Cp class=\"mb-4\"\u003EJunocam is an instrument onboard NASA&#39;s \u003Ca class=\"colorLink\" href=\"https:\u002F\u002Fwww.jpl.nasa.gov\u002Fmissions\u002Fjuno\u002F\" target=\"_blank\" rel=\"noopener noreferrer\"\u003EJuno spacecraft\u003C\u002Fa\u003E, which is currently orbiting Jupiter and sending back new imagery every month\nand a half as it reaches &#39;perijove&#39; - it&#39;s closest point to the planet. I&#39;ve written my own processing pipeline for this \u003Ca class=\"colorLink\" href=\"https:\u002F\u002Fwww.missionjuno.swri.edu\u002Fjunocam\u002Fprocessing\" target=\"_blank\" rel=\"noopener noreferrer\"\u003Eimage data\u003C\u002Fa\u003E\n(which I&#39;ll soon be re-writing, open-sourcing, and documenting here), and Juno Observer (a \u003Ca class=\"colorLink\" href=\"https:\u002F\u002Freactjs.org\u002F\" target=\"_blank\" rel=\"noopener noreferrer\"\u003EReact\u003C\u002Fa\u003E\u002F\u003Ca class=\"colorLink\" href=\"https:\u002F\u002Fthreejs.org\u002F\" target=\"_blank\" rel=\"noopener noreferrer\"\u003EThreeJS\u003C\u002Fa\u003E web-app) is my way of displaying the results.\u003C\u002Fp\u003E\n\u003Cp class=\"mb-4\"\u003EIt allows you to browse all of the available perijove data, projected onto a 3D representation of Jupiter, giving context to the imagery\nin a way that wasn&#39;t previously possible.\u003C\u002Fp\u003E\n\u003Cp class=\"mb-4\"\u003EThe live version of the app uses imagery from the original version of my processing pipeline, which has since vastly improved. I&#39;m also currently about\n75% of the way through a complete re-write of the app, which already contains a lot more features, thanks to the fact that is now uses\nthe same base structure as \u003Ca class=\"colorLink\" href=\".\u002Fprojects\u002Fareo-browser\"\u003EAreoBrowser\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\n",features:[{title:"15 Perijoves of Data",desc:"The live version of Juno Observer allows you to browse all of the images from the first 15 perijoves of Junocam data.",image:"images\u002Fjuno-observer\u002Fperijoves.jpg"},{title:"Full Resolution",desc:"Images are projected at full resolution, meaning you can zoom ALL the way in to Jupiter's ludicrous storm features.",image:"images\u002Fjuno-observer\u002Fdetail.jpg"},{title:"Fixed Rotation Mode",desc:"Toggle on \u003Ci\u003EFixed Rotation\u003C\u002Fi\u003E to lock Jupiter's rotation in place, making it easier to view subtle differences between exposures.",image:"images\u002Fjuno-observer\u002FfixedRot.jpg"}],todos:["Finish the new pipeline","Finish the new version üôÇ"],tagName:"junoobserver"},{id:b,slug:"areo-browser",name:"Areo Browser",smallImage:"images\u002Fareo-browser\u002Fsplash_small.jpeg",largeImage:"images\u002Fareo-browser\u002Fsplash_half.jpeg",shortDesc:"A web-app allowing you to explore nearly 2000 3D models of Mars, using data from HiRISE & HRSC.",keywords:"areo, areo-browser, areo browser, areobrowser, space, hirise, hrsc, browser, react, reactjs, mobile, desktop, dtm, gis, terrain, digital terrain model, mars, planet, planetary data, data",links:[{title:a,url:"https:\u002F\u002Fareobrowser.com"}],desc:"\u003Cp class=\"mb-4\"\u003EAreo Browser is a \u003Ca class=\"colorLink\" href=\"https:\u002F\u002Freactjs.org\u002F\" target=\"_blank\" rel=\"noopener noreferrer\"\u003EReact\u003C\u002Fa\u003E\u002F\u003Ca class=\"colorLink\" href=\"https:\u002F\u002Fthreejs.org\u002F\" target=\"_blank\" rel=\"noopener noreferrer\"\u003EThreeJS\u003C\u002Fa\u003E web-app that allows you to explore nearly 2000 Martian terrain models, in full 3D, directly in your browser and on mobile. \nIt currently uses data from both the \u003Ca class=\"colorLink\" href=\"https:\u002F\u002Fwww.uahirise.org\u002F\" target=\"_blank\" rel=\"noopener noreferrer\"\u003EHiRISE\u003C\u002Fa\u003E camera (on-board NASA&#39;s \u003Ca class=\"colorLink\" href=\"https:\u002F\u002Fmars.nasa.gov\u002Fmro\u002F\" target=\"_blank\" rel=\"noopener noreferrer\"\u003EMars Reconnaissance Orbiter\u003C\u002Fa\u003E), and the \u003Ca class=\"colorLink\" href=\"https:\u002F\u002Fwww.esa.int\u002FESA_Multimedia\u002FImages\u002F2004\u002F01\u002FThe_High_Resolution_Stereo_Camera_HRSC\" target=\"_blank\" rel=\"noopener noreferrer\"\u003EHRSC\u003C\u002Fa\u003E (on-board ESA&#39;s \u003Ca class=\"colorLink\" href=\"http:\u002F\u002Fwww.esa.int\u002FScience_Exploration\u002FSpace_Science\u002FMars_Express\" target=\"_blank\" rel=\"noopener noreferrer\"\u003EMars Express\u003C\u002Fa\u003E).\u003C\u002Fp\u003E\n\u003Cp class=\"mb-4\"\u003EWith options for mesh and image resolution, vertical exaggeration, and displaying a custom \u003Ca class=\"colorLink\" href=\"https:\u002F\u002Fjournals.plos.org\u002Fplosone\u002Farticle?id=10.1371\u002Fjournal.pone.0199239\" target=\"_blank\" rel=\"noopener noreferrer\"\u003ECividis\u003C\u002Fa\u003E gradient with contour mapping on the model,\nAreo Browser vastly increases the accessibility of the included data.\u003C\u002Fp\u003E\n\u003Cp class=\"mb-4\"\u003EThis new version of Areo Browser is able to process and view all types of Martian 3D data, so if you&#39;d like to talk about having your data included, \u003Ca class=\"colorLink\" href=\"mailto:hello@mattbrealey.com\"\u003Eplease just get in touch!\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\u003Cp class=\"mb-4\"\u003EEach available model consists of two parts - the mesh, and the associated image data.\u003C\u002Fp\u003E\n\u003Cp class=\"mb-4\"\u003EThe mesh is generated on-the-fly in the browser, using \u003Ca class=\"colorLink\" href=\"https:\u002F\u002Fdeveloper.mozilla.org\u002Fen-US\u002Fdocs\u002FWeb\u002FAPI\u002FWeb_Workers_API\u002FUsing_web_workers\" target=\"_blank\" rel=\"noopener noreferrer\"\u003EWeb Workers\u003C\u002Fa\u003E to convert a custom-encoded RGB image into the required height data.\nThis custom image format is an order-of-magnitude smaller than the original source file, but maintains a high-level of accuracy, and allows different resolutions to be quickly generated as needed.\nIt is created using an upcoming new version of my Mac-based conversion tool, \u003Ca class=\"colorLink\" href=\".\u002Fprojects\u002Fareo\"\u003EAreo\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\n\u003Cp class=\"mb-4\"\u003ETwo images are then applied to the model. The first is a colour image, created by combining all available RGB image data from the source files, and displayed at the desired resolution.\nThe second is a \u003Cem\u003Enormal\u003C\u002Fem\u003E map, which is a way of adding extra perceived detail to the model, without needing to increase the poly-count, again helping to ensure that the files can be viewed on older devices.\u003C\u002Fp\u003E\n",features:[{title:"Browse & Search Nearly 2000 Models",desc:"Filtering and sorting options make it SUPER easy to find the DTM you're looking for.",image:"images\u002Fareo-browser\u002FfileCount.jpg"},{title:"Multi-resolution Meshes & Imagery",desc:"Easily switch between 4 quality levels for meshes & their associated images, only downloading data when needed.",image:"images\u002Fareo-browser\u002Fresolution.jpg"},{title:"Works on both Desktop & Mobile",desc:"With a UI designed for phones, tablets and desktops, you can view slices of Mars on any of your devices.",image:"images\u002Fareo-browser\u002Fmobile.jpg"},{title:"Normal Maps to Provide Extra Detail",desc:"These generated images massively increase the perceived details on the loaded mesh, without requiring a more powerful machine.",image:"images\u002Fareo-browser\u002Fnormal.jpg"},{title:"Vertical Exaggeration Options",desc:"Increase the vertical scale of the loaded mesh up to 5x, to make even the flattest terrain easier to understand.",image:"images\u002Fareo-browser\u002Fve.gif"},{title:"Altimetry Mode",desc:"Apply an easy-to-read elevation gradiant to the model, with overlaid contour lines at custom intervals ranging from 5m to 5km.",image:"images\u002Fareo-browser\u002Falt.gif"}],todos:["Model downloads","3D-printable model generation and downloads","Ability to save an image of the current view, with a transparent background","Ability to share a link to the current model with the current camera angle","Realistic lighting based upon location and a given time, using a full sun\u002Fsky model","WASD navigation","Basic fly-over\u002Fanimation support","Ability to search by a range of values (e.g. elevation in the range 100-200m)","Apply for a DOI so the site can be easily referenced"],tagName:"areobrowser"},{id:3,slug:d,name:"Geode (prototype)",smallImage:"images\u002Fgeode\u002Fsplash_small.jpg",largeImage:"images\u002Fgeode\u002Fsplash_half.jpg",shortDesc:"A WIP web-app that allows you to preview GeoTiff metadata extremely quickly, directly in your browser.",keywords:"tiff, geotiff, dtm, gis, mapping, terrain, digital terrain model, planetary data, data",links:[{title:a,url:"https:\u002F\u002Fmattbrealey.com\u002Fgeode"}],desc:"\u003Cp class=\"mb-4\"\u003EGeode is a web-app prototype that allows you to quickly and easily query the metadata stored inside any GeoTiff file simply by dragging the file into your browser.\u003C\u002Fp\u003E\n\u003Cp class=\"mb-4\"\u003EAs part of my \u003Ca class=\"colorLink\" href=\".\u002Fprojects\u002Fareo-browser\"\u003EAreoBrowser\u003C\u002Fa\u003E pipeline work, I needed to figure out the structure of the GeoTiff format. In the spirit of trying to create smaller projects,\nshare more code, and write a few \u003Cem\u003Ehopefully\u003C\u002Fem\u003E useful but no-doubt incredibly niche tools, I decided to spend a few hours over a few days to see if I could get\nTiff header reading working in-browser, using \u003Ca class=\"colorLink\" href=\"https:\u002F\u002Fsvelte.dev\u002F\" target=\"_blank\" rel=\"noopener noreferrer\"\u003ESvelte\u003C\u002Fa\u003E and \u003Ca class=\"colorLink\" href=\"https:\u002F\u002Fmedium.com\u002Fsamsung-internet-dev\u002Fweb-workers-in-the-real-world-d61387958a40\" target=\"_blank\" rel=\"noopener noreferrer\"\u003EWeb Workers\u003C\u002Fa\u003E.\nGeode is the result. \u003C\u002Fp\u003E\n\u003Cp class=\"mb-4\"\u003ERight now this prototype just gathers all of the included metadata info behind the scenes, and displays some (somewhat arbitrary) image information on completion. \nThe next step is to display that information in a useful way, with an image preview \u003Cem\u003Eand potentially\u003C\u002Fem\u003E a 3D preview as well!\u003C\u002Fp\u003E\n\u003Cp class=\"mb-4\"\u003EIf you have any feature requests, just let me know \u003Ca class=\"colorLink\" href=\"https:\u002F\u002Ftwitter.com\u002Fbadgrenola\" target=\"_blank\" rel=\"noopener noreferrer\"\u003Eover on Twitter\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\n",features:[],todos:["Finalise a UI design","Implement the UI","Experiment with image previews at different resolutions","Experiment with a 3D preview"],tagName:d}]}}("Website",2,"areo","geode")),null,{article:{slug:"reading-tiff-tags",metadata:{title:"Reading Tiff Tags üè∑",pubdate:"2020-04-15",smallImage:"images\u002Farticles\u002Freading-tiff-tags\u002Ftags.png",desc:"For my new tool, Geode, I needed to learn ALL about tiff tags. Turns out, there's a LOT of them...",keywords:"geode, tiff, code, geotiff, mapping, data, gis",date:"15th April 2020",timeToRead:6},html:"\u003Cp class=\"mb-4\"\u003EI&#39;m currently in the process of adding several other formats to \u003Ca class=\"colorLink\" href=\"\u002Fprojects\u002Fareo\"\u003EAreo\u003C\u002Fa\u003E, my \u003Cem\u003E&#39;take binary elevation data and make into exportable 3D mesh&#39;\u003C\u002Fem\u003E tool, one of which is \u003Ca class=\"colorLink\" href=\"https:\u002F\u002Fearthdata.nasa.gov\u002Fesdis\u002Feso\u002Fstandards-and-references\u002Fgeotiff\" target=\"_blank\" rel=\"noopener noreferrer\"\u003EGeotiff\u003C\u002Fa\u003E. Instead of just figuring out how to read the format (boo, boring, boo), I thought I&#39;d try and make an in-browser tool to read local tiff files, show 2D previews with custom colour mapping, and generate downloadable 3D mesh previews if applicable (hooray, 3D things, yay!) I also thought I&#39;d briefly write it all up as I went. üëã\u003C\u002Fp\u003E\n\u003Ch2 id=\"incredibly-useful-sources-of-information\"\u003EIncredibly useful sources of information\u003C\u002Fh2\u003E\n\u003Cul\u003E\n\u003Cli\u003E\u003Ca class=\"colorLink\" href=\"https:\u002F\u002Fmedium.com\u002Fplanet-stories\u002Freading-a-single-tiff-pixel-without-any-tiff-tools-fcbd43d8bd24\" target=\"_blank\" rel=\"noopener noreferrer\"\u003EThis article\u003C\u002Fa\u003E by Patrick Armstrong really quickly got me up to speed on exactly how the header information in a .tiff file is formatted. Patrick also delves into things like compression, that I&#39;ll definitely have to address down the line.\u003C\u002Fli\u003E\n\u003Cli\u003EWant to know what that random tiff tag ID is? Want to know all the possible values in its enum? Well Joris Van Damme from \u003Ca class=\"colorLink\" href=\"https:\u002F\u002Fwww.awaresystems.be\u002Fimaging\u002Ftiff\u002Ftifftags.html\" target=\"_blank\" rel=\"noopener noreferrer\"\u003EAware Systems\u003C\u002Fa\u003E has you covered! This site is basically a tiff tag bible. It was \u003Cstrong\u003Einsanely\u003C\u002Fstrong\u003E useful.\u003C\u002Fli\u003E\n\u003Cli\u003EAs was \u003Ca class=\"colorLink\" href=\"http:\u002F\u002Fgeotiff.maptools.org\u002Fspec\u002Fgeotiff1.html\" target=\"_blank\" rel=\"noopener noreferrer\"\u003EMaptools.org\u003C\u002Fa\u003E! \u003Cem\u003EMany\u003C\u002Fem\u003E of my Google searches brought me back to the fantastically curated information on this site.\u003C\u002Fli\u003E\n\u003Cli\u003EPaul Bourke&#39;s \u003Ca class=\"colorLink\" href=\"http:\u002F\u002Fpaulbourke.net\u002Fdataformats\u002Ftiff\u002Ftiff_summary.pdf\" target=\"_blank\" rel=\"noopener noreferrer\"\u003EPDF Tiff Summary\u003C\u002Fa\u003E was also \u003Cem\u003ESUPER\u003C\u002Fem\u003E useful in clarifying the different data types used in the format.\u003C\u002Fli\u003E\n\u003Cli\u003EFinally, I stumbled upon \u003Ca class=\"colorLink\" href=\"https:\u002F\u002Ftwitter.com\u002Femilywselwood\" target=\"_blank\" rel=\"noopener noreferrer\"\u003EEmily Selwood\u003C\u002Fa\u003E&#39;s fantastic \u003Ca class=\"colorLink\" href=\"https:\u002F\u002Fgithub.com\u002Femilyselwood\u002Ftiffhax\" target=\"_blank\" rel=\"noopener noreferrer\"\u003ETiff Hax\u003C\u002Fa\u003E tool as I was getting into the nitty gritty of IFD reading, and although I&#39;ve yet to delve into \u003Ca class=\"colorLink\" href=\"https:\u002F\u002Fgolang.org\u002F\" target=\"_blank\" rel=\"noopener noreferrer\"\u003EGo\u003C\u002Fa\u003E, it was a fantastically useful sanity checker when it came to testing my own code!\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Ch2 id=\"breaking-down-the-format\"\u003EBreaking down the format\u003C\u002Fh2\u003E\n\u003Ch3 id=\"byte-order--a-very-magic-number\"\u003EByte Order &amp; A Very Magic Number\u003C\u002Fh3\u003E\n\u003Cp class=\"mb-4\"\u003EAt the start of \u003Cem\u003Eevery\u003C\u002Fem\u003E .tiff file there are 8 bytes of data. Something like :\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode\u003E4D4D002A 00000008\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp class=\"mb-4\"\u003EThe first 2 bytes are either going to be both \u003Cem\u003E4D\u003C\u002Fem\u003E (i.e. \u003Cem\u003E77\u003C\u002Fem\u003E as a UInt8), or \u003Cem\u003E49\u003C\u002Fem\u003E (i.e. \u003Cem\u003E73\u003C\u002Fem\u003E as a UInt8). If it&#39;s \u003Cem\u003E4D (77)\u003C\u002Fem\u003E the \u003Ca class=\"colorLink\" href=\"https:\u002F\u002Fwww.geeksforgeeks.org\u002Flittle-and-big-endian-mystery\u002F\" target=\"_blank\" rel=\"noopener noreferrer\"\u003Ebyte order\u003C\u002Fa\u003E of the file is BigEndian, if it&#39;s \u003Cem\u003E49 (73)\u003C\u002Fem\u003E byte order is LittleEndian. The example above is therefore BigEndian.\u003C\u002Fp\u003E\n\u003Cp class=\"mb-4\"\u003EThe 3rd or 4th byte (depending on your newly found byte order) is a \u003Ca class=\"colorLink\" href=\"https:\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FMagic_number_(programming)\" target=\"_blank\" rel=\"noopener noreferrer\"\u003Emagic number\u003C\u002Fa\u003E. Long story short, if it&#39;s not \u003Cstrong\u003E42\u003C\u002Fstrong\u003E, then this \u003Cem\u003Eisn&#39;t\u003C\u002Fem\u003E a tiff file. Time to return\u002Fthrow an error\u002Fwalk away and grab lunch.\u003C\u002Fp\u003E\n\u003Cp class=\"mb-4\"\u003EThe 8th byte is a byte offset telling you where the first main section of header information begins. Which leads me nicely into...\u003C\u002Fp\u003E\n\u003Ch3 id=\"ifds-subfiles-image-bands\"\u003EIFDs, subfiles, image bands...\u003C\u002Fh3\u003E\n\u003Cp class=\"mb-4\"\u003EA single tiff file \u003Cem\u003Ecan\u003C\u002Fem\u003E hold multiple different (but more often than not, at least tangentially related) images within it. These \u003Ca class=\"colorLink\" href=\"https:\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FTIFF#Multiple_subfiles\" target=\"_blank\" rel=\"noopener noreferrer\"\u003Esubfiles\u003C\u002Fa\u003E can be incredibly useful for storing lower resolution proxies of a main image, mask data, overlay information - essentially anything you want to bundle alongside the main image data.\u003C\u002Fp\u003E\n\u003Cp class=\"mb-4\"\u003EEach one of these subfiles is described by an Image File Directory (IFD) - a section of header information containing \u003Cem\u003Eall\u003C\u002Fem\u003E the metadata associated with that subfile. In theory. In practice, some of the tags on the first IFD are usually relevant to one or more of the subsequent IFDs, and as you delve deeper you might find other completely separate IFDs that contain \u003Cem\u003Eyet more\u003C\u002Fem\u003E metadata relevant to the first IFD. Tiffs are nothing if not flexible.\u003C\u002Fp\u003E\n\u003Cp class=\"mb-4\"\u003EIf we follow the 8 byte offset we found above, we find ourselves at the start of our first IFD, which begins with these two bytes :\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode\u003E0010\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp class=\"mb-4\"\u003EThis is our IFD field count, which after converting to UInt8 tells us that there are 16 fields we now need to find and parse.\u003C\u002Fp\u003E\n\u003Ch3 id=\"fields-oh-so-many-fields\"\u003EFields. Oh so many fields...\u003C\u002Fh3\u003E\n\u003Cp class=\"mb-4\"\u003EIFD fields are always 12 bytes long, so let&#39;s grab the next 12 bytes and start parsing :\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode\u003E01000003 00000001 0C890000\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp class=\"mb-4\"\u003EThe first 2 bytes give us the ID of the tiff tag. Converting \u003Ccode\u003E0100\u003C\u002Fcode\u003E to a short (AKA a 16-bit unsigned int) gives us a value of 256. One search of \u003Ca class=\"colorLink\" href=\"https:\u002F\u002Fwww.awaresystems.be\u002Fimaging\u002Ftiff\u002Ftifftags\u002Fsearch.html?q=256&amp;Submit=Find+Tags\" target=\"_blank\" rel=\"noopener noreferrer\"\u003EAwareSystems Tiff Tag Reference\u003C\u002Fa\u003E later and :\u003C\u002Fp\u003E\n\u003Cp class=\"mb-4\"\u003E\u003Cimg src=\"images\u002Farticles\u002Freading-tiff-tags\u002FimageWidthTag.png\" alt=\"ImageWidth tag details\"\u003E\u003C\u002Fp\u003E\n\u003Cp class=\"mb-4\"\u003EWe&#39;ve found an \u003Cem\u003EImageWidth\u003C\u002Fem\u003E tag! Let&#39;s move on and try to get the width itself.\u003C\u002Fp\u003E\n\u003Cp class=\"mb-4\"\u003EThe 3rd and 4th bytes give us the data type of this tag. Converting to a short, our \u003Ccode\u003E0003\u003C\u002Fcode\u003E gives a value of 3, meaning that the image width is also going to be a short.\u003C\u002Fp\u003E\n\u003Cp class=\"mb-4\"\u003EThe next 4 bytes give us the value count for the current field as a 32-bit unsigned int. In our case above, the \u003Ccode\u003E00000001\u003C\u002Fcode\u003E tells us that (logically) \u003Cem\u003EImageWidth\u003C\u002Fem\u003E only has a single value. \u003C\u002Fp\u003E\n\u003Cp class=\"mb-4\"\u003EThe behaviour of the remaining 4 bytes differs slightly from field to field, depending on the data the field represents. For some fields with a single (often numerical) associated value, all of that value data can be found directly within the field bytes. However, in fields representing more complex values (such as arrays of information, longer strings etc.) the remaining bytes simply act as an offset to where that information is stored in the main body of the tiff file.\u003C\u002Fp\u003E\n\u003Cp class=\"mb-4\"\u003ETo determine whether the final bytes represent an offset, we can perform a simple calculation : \u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode\u003E(# of values) * (# of bytes per value) &gt; (# of bytes remaining)\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp class=\"mb-4\"\u003EWe know that we only have 4 bytes left from our original 12 bytes of field data, we&#39;ve already calculated our value count, and we know that the data type is \u003Cem\u003Eshort\u003C\u002Fem\u003E (i.e. 2 bytes per value). So in the case of our \u003Cem\u003EImageWidth\u003C\u002Fem\u003E field, this calculation becomes :\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode\u003EisOffset = (1 * 2) &gt; 4\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp class=\"mb-4\"\u003EThis evaluates to false in our \u003Cem\u003EImageWidth\u003C\u002Fem\u003E case, meaning that the final 4 bytes represent the actual value of the field. These bytes are \u003Ccode\u003E0C890000\u003C\u002Fcode\u003E, which we can now convert to a value of \u003Cem\u003E3209\u003C\u002Fem\u003E. We&#39;ve found the width of our tiff file!\u003C\u002Fp\u003E\n\u003Cp class=\"mb-4\"\u003EIf \u003Cem\u003EisOffset\u003C\u002Fem\u003E had resolved to \u003Cem\u003Etrue\u003C\u002Fem\u003E, we&#39;d then have to perform a subsequent lookup into the tiff file, using the value of the final 4 bytes as our offset, and \u003Ccode\u003E(# of values) * (# of bytes per value)\u003C\u002Fcode\u003E as our byte count.\u003C\u002Fp\u003E\n\u003Ch3 id=\"the-next-ifd\"\u003EThe next IFD...\u003C\u002Fh3\u003E\n\u003Cp class=\"mb-4\"\u003E16 fields of 12 bytes later, there are 8 more useful bytes that make up this current IFD. Converted to a long (i.e. 4 byte, 32-bit unsigned int) these bytes give you the byte offset to the next IFD contained within the tiff file. \u003C\u002Fp\u003E\n\u003Cp class=\"mb-4\"\u003EIf this byte offset is &gt; 0, you&#39;ll need to loop around and repeat all of your field parsing on this new IFD. If this is the final IFD in the file, the byte offset will be 0, and you can now relatively comfortably stop processing IFDs. Hooray!\u003C\u002Fp\u003E\n\u003Ch2 id=\"so-far-so-good\"\u003ESo far, so good\u003C\u002Fh2\u003E\n\u003Cp class=\"mb-4\"\u003ESo ends this first, pretty dry article about Geode! Fun, eh? üò¨ I&#39;m hoping that the above might prove vaguely useful to anyone thinking about attempting something similar. And if not, it will at least remind me how I approached it, when I no-doubt find myself doing this again in a year or so!\u003C\u002Fp\u003E\n\u003Cp class=\"mb-4\"\u003EIf you head over to \u003Ca class=\"colorLink\" href=\"https:\u002F\u002Fmattbrealey.com\u002Fgeode\" target=\"_blank\" rel=\"noopener noreferrer\"\u003Ethe app\u003C\u002Fa\u003E right now, you&#39;ll be able to see the above in practice, as you can load any tiff file and browse of the available tag information for each IFD found.\u003C\u002Fp\u003E\n\u003Cp class=\"mb-4\"\u003ENext step, pixel loading!\u003C\u002Fp\u003E\n",prev:{slug:"hello-motivation",title:"Hello Motivation"},next:null}}],session:(function(a,b,c){return {projects:{areo:{id:0,slug:b,name:"Areo",smallImage:"images\u002Fareo\u002Fsplash_small.jpg",largeImage:"images\u002Fareo\u002Fsplash.jpg",shortDesc:"A Mac app designed for opening, viewing and converting Digital Terrain Models.",keywords:"areo, space, hirise, mac, osx, swift, dtm, gis, terrain, digital terrain model, mars, planet, planetary data, data",links:[{title:"Download Beta 1 v2",url:"http:\u002F\u002Fbit.ly\u002Fareo1b2"}],desc:"\u003Cp class=\"mb-4\"\u003EAreo is a custom Mac app designed for opening, viewing and converting Digital Terrain Models in the \u003Cem\u003E.IMG\u003C\u002Fem\u003E format. \u003C\u002Fp\u003E\n\u003Cp class=\"mb-4\"\u003EThe released version (available above) was designed specifically to quickly open .IMG files generated from \u003Ca class=\"colorLink\" href=\"https:\u002F\u002Fwww.uahirise.org\u002Fdtm\u002F\" target=\"_blank\" rel=\"noopener noreferrer\"\u003EHiRISE\u003C\u002Fa\u003E imagery, \nand convert them into .OBJ files at a given proxy level (\u003Cem\u003E1\u002F2, 1\u002F4, 1\u002F8\u003C\u002Fem\u003E etc.).\nIt also includes the ability to generate 3D-printable versions of these models.\u003C\u002Fp\u003E\n\u003Cp class=\"mb-4\"\u003EIt was originally created as part of a month-long project I set myself, to see if I could both understand the data structure, and \ncreate a tool that not only opens the files quickly, but also converts them into a useful, more-accessible 3D format.\u003C\u002Fp\u003E\n\u003Cp class=\"mb-4\"\u003EI have been working on a newer version of this app which expands the amount of file formats, and implements a command-line version\nof the featureset. This new version currently forms part of my \u003Ca class=\"colorLink\" href=\".\u002Fprojects\u002Fareo-browser\"\u003EAreo Browser\u003C\u002Fa\u003E data pipeline, and I plan on\ndocumenting and releasing it here in the near future.\u003C\u002Fp\u003E\n",features:[{title:"Fast. Very Fast.",desc:"Thanks to Areo's crafty use of image proxying, it takes just 4 seconds to load and process a 1.15gb DTM.",image:"https:\u002F\u002Fthumbs.gfycat.com\u002FGlumIdealisticGallinule-small.gif"},{title:"OBJ Export",desc:"Areo can quickly export a UV'd OBJ file of the current model for use in other 3D applications.",image:"https:\u002F\u002Fthumbs.gfycat.com\u002FCluelessEasygoingIceblueredtopzebra-small.gif"},{title:"Generate 3D-Printable Models",desc:"In a few clicks, Areo allows you to generate fully 3D-printable models that can be easily uploaded to your 3D-printing service of choice.",image:"https:\u002F\u002Fthumbs.gfycat.com\u002FOddQuickAfricanbushviper-small.gif"}],todos:["Clean-up the code in v2 and release"],tagName:b},"areo-browser":{id:2,slug:"areo-browser",name:"Areo Browser",smallImage:"images\u002Fareo-browser\u002Fsplash_small.jpeg",largeImage:"images\u002Fareo-browser\u002Fsplash_half.jpeg",shortDesc:"A web-app allowing you to explore nearly 2000 3D models of Mars, using data from HiRISE & HRSC.",keywords:"areo, areo-browser, areo browser, areobrowser, space, hirise, hrsc, browser, react, reactjs, mobile, desktop, dtm, gis, terrain, digital terrain model, mars, planet, planetary data, data",links:[{title:a,url:"https:\u002F\u002Fareobrowser.com"}],desc:"\u003Cp class=\"mb-4\"\u003EAreo Browser is a \u003Ca class=\"colorLink\" href=\"https:\u002F\u002Freactjs.org\u002F\" target=\"_blank\" rel=\"noopener noreferrer\"\u003EReact\u003C\u002Fa\u003E\u002F\u003Ca class=\"colorLink\" href=\"https:\u002F\u002Fthreejs.org\u002F\" target=\"_blank\" rel=\"noopener noreferrer\"\u003EThreeJS\u003C\u002Fa\u003E web-app that allows you to explore nearly 2000 Martian terrain models, in full 3D, directly in your browser and on mobile. \nIt currently uses data from both the \u003Ca class=\"colorLink\" href=\"https:\u002F\u002Fwww.uahirise.org\u002F\" target=\"_blank\" rel=\"noopener noreferrer\"\u003EHiRISE\u003C\u002Fa\u003E camera (on-board NASA&#39;s \u003Ca class=\"colorLink\" href=\"https:\u002F\u002Fmars.nasa.gov\u002Fmro\u002F\" target=\"_blank\" rel=\"noopener noreferrer\"\u003EMars Reconnaissance Orbiter\u003C\u002Fa\u003E), and the \u003Ca class=\"colorLink\" href=\"https:\u002F\u002Fwww.esa.int\u002FESA_Multimedia\u002FImages\u002F2004\u002F01\u002FThe_High_Resolution_Stereo_Camera_HRSC\" target=\"_blank\" rel=\"noopener noreferrer\"\u003EHRSC\u003C\u002Fa\u003E (on-board ESA&#39;s \u003Ca class=\"colorLink\" href=\"http:\u002F\u002Fwww.esa.int\u002FScience_Exploration\u002FSpace_Science\u002FMars_Express\" target=\"_blank\" rel=\"noopener noreferrer\"\u003EMars Express\u003C\u002Fa\u003E).\u003C\u002Fp\u003E\n\u003Cp class=\"mb-4\"\u003EWith options for mesh and image resolution, vertical exaggeration, and displaying a custom \u003Ca class=\"colorLink\" href=\"https:\u002F\u002Fjournals.plos.org\u002Fplosone\u002Farticle?id=10.1371\u002Fjournal.pone.0199239\" target=\"_blank\" rel=\"noopener noreferrer\"\u003ECividis\u003C\u002Fa\u003E gradient with contour mapping on the model,\nAreo Browser vastly increases the accessibility of the included data.\u003C\u002Fp\u003E\n\u003Cp class=\"mb-4\"\u003EThis new version of Areo Browser is able to process and view all types of Martian 3D data, so if you&#39;d like to talk about having your data included, \u003Ca class=\"colorLink\" href=\"mailto:hello@mattbrealey.com\"\u003Eplease just get in touch!\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\u003Cp class=\"mb-4\"\u003EEach available model consists of two parts - the mesh, and the associated image data.\u003C\u002Fp\u003E\n\u003Cp class=\"mb-4\"\u003EThe mesh is generated on-the-fly in the browser, using \u003Ca class=\"colorLink\" href=\"https:\u002F\u002Fdeveloper.mozilla.org\u002Fen-US\u002Fdocs\u002FWeb\u002FAPI\u002FWeb_Workers_API\u002FUsing_web_workers\" target=\"_blank\" rel=\"noopener noreferrer\"\u003EWeb Workers\u003C\u002Fa\u003E to convert a custom-encoded RGB image into the required height data.\nThis custom image format is an order-of-magnitude smaller than the original source file, but maintains a high-level of accuracy, and allows different resolutions to be quickly generated as needed.\nIt is created using an upcoming new version of my Mac-based conversion tool, \u003Ca class=\"colorLink\" href=\".\u002Fprojects\u002Fareo\"\u003EAreo\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\n\u003Cp class=\"mb-4\"\u003ETwo images are then applied to the model. The first is a colour image, created by combining all available RGB image data from the source files, and displayed at the desired resolution.\nThe second is a \u003Cem\u003Enormal\u003C\u002Fem\u003E map, which is a way of adding extra perceived detail to the model, without needing to increase the poly-count, again helping to ensure that the files can be viewed on older devices.\u003C\u002Fp\u003E\n",features:[{title:"Browse & Search Nearly 2000 Models",desc:"Filtering and sorting options make it SUPER easy to find the DTM you're looking for.",image:"images\u002Fareo-browser\u002FfileCount.jpg"},{title:"Multi-resolution Meshes & Imagery",desc:"Easily switch between 4 quality levels for meshes & their associated images, only downloading data when needed.",image:"images\u002Fareo-browser\u002Fresolution.jpg"},{title:"Works on both Desktop & Mobile",desc:"With a UI designed for phones, tablets and desktops, you can view slices of Mars on any of your devices.",image:"images\u002Fareo-browser\u002Fmobile.jpg"},{title:"Normal Maps to Provide Extra Detail",desc:"These generated images massively increase the perceived details on the loaded mesh, without requiring a more powerful machine.",image:"images\u002Fareo-browser\u002Fnormal.jpg"},{title:"Vertical Exaggeration Options",desc:"Increase the vertical scale of the loaded mesh up to 5x, to make even the flattest terrain easier to understand.",image:"images\u002Fareo-browser\u002Fve.gif"},{title:"Altimetry Mode",desc:"Apply an easy-to-read elevation gradiant to the model, with overlaid contour lines at custom intervals ranging from 5m to 5km.",image:"images\u002Fareo-browser\u002Falt.gif"}],todos:["Model downloads","3D-printable model generation and downloads","Ability to save an image of the current view, with a transparent background","Ability to share a link to the current model with the current camera angle","Realistic lighting based upon location and a given time, using a full sun\u002Fsky model","WASD navigation","Basic fly-over\u002Fanimation support","Ability to search by a range of values (e.g. elevation in the range 100-200m)","Apply for a DOI so the site can be easily referenced"],tagName:"areobrowser"},"juno-observer":{id:1,slug:"juno-observer",name:"Juno Observer",smallImage:"images\u002Fjuno-observer\u002Fsplash_small.jpeg",largeImage:"images\u002Fjuno-observer\u002Fsplash_half.jpeg",shortDesc:"A web-app allowing you to explore Junocam imagery from NASA's Juno spacecraft, projected onto a 3D Jupiter.",keywords:"juno, space, nasa, jupiter, browser, react, reactjs, mobile, desktop, planet, planetary data, data, spacecraft, orbit, perijove, mission juno",links:[{title:a,url:"https:\u002F\u002Fjuno.observer"}],desc:"\u003Cp class=\"mb-4\"\u003EJunocam is an instrument onboard NASA&#39;s \u003Ca class=\"colorLink\" href=\"https:\u002F\u002Fwww.jpl.nasa.gov\u002Fmissions\u002Fjuno\u002F\" target=\"_blank\" rel=\"noopener noreferrer\"\u003EJuno spacecraft\u003C\u002Fa\u003E, which is currently orbiting Jupiter and sending back new imagery every month\nand a half as it reaches &#39;perijove&#39; - it&#39;s closest point to the planet. I&#39;ve written my own processing pipeline for this \u003Ca class=\"colorLink\" href=\"https:\u002F\u002Fwww.missionjuno.swri.edu\u002Fjunocam\u002Fprocessing\" target=\"_blank\" rel=\"noopener noreferrer\"\u003Eimage data\u003C\u002Fa\u003E\n(which I&#39;ll soon be re-writing, open-sourcing, and documenting here), and Juno Observer (a \u003Ca class=\"colorLink\" href=\"https:\u002F\u002Freactjs.org\u002F\" target=\"_blank\" rel=\"noopener noreferrer\"\u003EReact\u003C\u002Fa\u003E\u002F\u003Ca class=\"colorLink\" href=\"https:\u002F\u002Fthreejs.org\u002F\" target=\"_blank\" rel=\"noopener noreferrer\"\u003EThreeJS\u003C\u002Fa\u003E web-app) is my way of displaying the results.\u003C\u002Fp\u003E\n\u003Cp class=\"mb-4\"\u003EIt allows you to browse all of the available perijove data, projected onto a 3D representation of Jupiter, giving context to the imagery\nin a way that wasn&#39;t previously possible.\u003C\u002Fp\u003E\n\u003Cp class=\"mb-4\"\u003EThe live version of the app uses imagery from the original version of my processing pipeline, which has since vastly improved. I&#39;m also currently about\n75% of the way through a complete re-write of the app, which already contains a lot more features, thanks to the fact that is now uses\nthe same base structure as \u003Ca class=\"colorLink\" href=\".\u002Fprojects\u002Fareo-browser\"\u003EAreoBrowser\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\n",features:[{title:"15 Perijoves of Data",desc:"The live version of Juno Observer allows you to browse all of the images from the first 15 perijoves of Junocam data.",image:"images\u002Fjuno-observer\u002Fperijoves.jpg"},{title:"Full Resolution",desc:"Images are projected at full resolution, meaning you can zoom ALL the way in to Jupiter's ludicrous storm features.",image:"images\u002Fjuno-observer\u002Fdetail.jpg"},{title:"Fixed Rotation Mode",desc:"Toggle on \u003Ci\u003EFixed Rotation\u003C\u002Fi\u003E to lock Jupiter's rotation in place, making it easier to view subtle differences between exposures.",image:"images\u002Fjuno-observer\u002FfixedRot.jpg"}],todos:["Finish the new pipeline","Finish the new version üôÇ"],tagName:"junoobserver"},geode:{id:3,slug:c,name:"Geode (prototype)",smallImage:"images\u002Fgeode\u002Fsplash_small.jpg",largeImage:"images\u002Fgeode\u002Fsplash_half.jpg",shortDesc:"A WIP web-app that allows you to preview GeoTiff metadata extremely quickly, directly in your browser.",keywords:"tiff, geotiff, dtm, gis, mapping, terrain, digital terrain model, planetary data, data",links:[{title:a,url:"https:\u002F\u002Fmattbrealey.com\u002Fgeode"}],desc:"\u003Cp class=\"mb-4\"\u003EGeode is a web-app prototype that allows you to quickly and easily query the metadata stored inside any GeoTiff file simply by dragging the file into your browser.\u003C\u002Fp\u003E\n\u003Cp class=\"mb-4\"\u003EAs part of my \u003Ca class=\"colorLink\" href=\".\u002Fprojects\u002Fareo-browser\"\u003EAreoBrowser\u003C\u002Fa\u003E pipeline work, I needed to figure out the structure of the GeoTiff format. In the spirit of trying to create smaller projects,\nshare more code, and write a few \u003Cem\u003Ehopefully\u003C\u002Fem\u003E useful but no-doubt incredibly niche tools, I decided to spend a few hours over a few days to see if I could get\nTiff header reading working in-browser, using \u003Ca class=\"colorLink\" href=\"https:\u002F\u002Fsvelte.dev\u002F\" target=\"_blank\" rel=\"noopener noreferrer\"\u003ESvelte\u003C\u002Fa\u003E and \u003Ca class=\"colorLink\" href=\"https:\u002F\u002Fmedium.com\u002Fsamsung-internet-dev\u002Fweb-workers-in-the-real-world-d61387958a40\" target=\"_blank\" rel=\"noopener noreferrer\"\u003EWeb Workers\u003C\u002Fa\u003E.\nGeode is the result. \u003C\u002Fp\u003E\n\u003Cp class=\"mb-4\"\u003ERight now this prototype just gathers all of the included metadata info behind the scenes, and displays some (somewhat arbitrary) image information on completion. \nThe next step is to display that information in a useful way, with an image preview \u003Cem\u003Eand potentially\u003C\u002Fem\u003E a 3D preview as well!\u003C\u002Fp\u003E\n\u003Cp class=\"mb-4\"\u003EIf you have any feature requests, just let me know \u003Ca class=\"colorLink\" href=\"https:\u002F\u002Ftwitter.com\u002Fbadgrenola\" target=\"_blank\" rel=\"noopener noreferrer\"\u003Eover on Twitter\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\n",features:[],todos:["Finalise a UI design","Implement the UI","Experiment with image previews at different resolutions","Experiment with a 3D preview"],tagName:c}}}}("Website","areo","geode"))};if('serviceWorker' in navigator)navigator.serviceWorker.register('/service-worker.js');var s=document.createElement("script");try{new Function("if(0)import('')")();s.src="/client/client.c6eaf1ca.js";s.type="module";s.crossOrigin="use-credentials";}catch(e){s.src="/client/shimport@1.0.1.js";s.setAttribute("data-main","/client/client.c6eaf1ca.js")}document.head.appendChild(s)</script> 